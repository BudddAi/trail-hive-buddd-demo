---
import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';
import ModuleWrapper from '../utils/ModuleWrapper.astro';
import { assetsPath } from '../utils/strapi';
import Heading from './molecules/Heading.astro';
import Image from './molecules/Image.astro';
import CarouselArrowButton from './molecules/CarouselArrowButton.astro';

interface GalleryBlockProps {
  heading: {
    text: string;
    subheading?: string;
    tag?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';
    preheading?: string;
  };
  images: Array<{
    url: string;
    alternativeText?: string;
    width?: number;
    height?: number;
  }>;
  spacing?: any;
}

export interface Props extends GalleryBlockProps {}

const { 
  heading,
  images = [],
  spacing
} = Astro.props;

const headingClassName = "text-center [&>h2]:text-color-37 [&>h2]:font-bold [&>h2]:text-size-4 md:[&>h2]:text-5xl [&>h2]:leading-lh-1 [&>h2]:tracking-tracking-1 [&>p]:text-color-37 [&>p]:text-lg [&>p]:leading-lh-16";
---

<ModuleWrapper className="gallery-block" spacing={spacing}>
  <div class="bg-color-11 py-16 md:py-24 overflow-hidden">
    <div class="container">
      {heading && (
        <Heading 
          as={heading.tag || 'h2'}
          heading={heading.text}
          subheading={heading.subheading}
          preheading={heading.preheading}
          className={headingClassName}
        />
      )}
    </div>
    
    {images && images.length > 0 && (
      <div class="relative mt-12">
        <div class="gallery-prev absolute top-1/2 -translate-y-1/2 left-4 md:left-8 z-20 cursor-pointer">
          <CarouselArrowButton direction="left" />
        </div>
        <div class="gallery-next absolute top-1/2 -translate-y-1/2 right-4 md:right-8 z-20 cursor-pointer">
          <CarouselArrowButton direction="right" />
        </div>

        <div class="swiper gallery-swiper !px-0">
          <div class="swiper-wrapper">
            {images.map((image) => (
              <div class="swiper-slide">
                <Image 
                  src={assetsPath(image.url) || ''}
                  alt={image.alternativeText || 'Gallery image'}
                  className="w-full h-auto object-cover rounded-radius-3 aspect-[1/1] md:aspect-[4/3]"
                />
              </div>
            ))}
          </div>
        </div>
        
        <div class="gallery-pagination relative mt-8 flex justify-center"></div>
      </div>
    )}
  </div>
</ModuleWrapper>

<script>
  import { Swiper } from 'swiper';
  import { Navigation, Pagination } from 'swiper/modules';

  document.addEventListener('DOMContentLoaded', () => {
    const gallerySwiper = new Swiper('.gallery-swiper', {
      modules: [Navigation, Pagination],
      spaceBetween: 24,
      slidesPerView: 1.2,
      centeredSlides: true,
      loop: true,
      pagination: { 
        el: '.gallery-pagination', 
        clickable: true 
      },
      navigation: {
        nextEl: '.gallery-next',
        prevEl: '.gallery-prev',
      },
      breakpoints: {
        768: {
          slidesPerView: 2.5,
          centeredSlides: false,
        },
        1280: {
          slidesPerView: 3.5,
          centeredSlides: true,
        },
      },
    });
  });
</script>

<style is:global>
  .gallery-pagination .swiper-pagination-bullet {
    width: 8px;
    height: 8px;
    background-color: var(--color-9, #232e2666);
    opacity: 1;
    transition: background-color 0.3s ease;
    margin: 0 6px !important;
  }
  .gallery-pagination .swiper-pagination-bullet-active {
    background-color: var(--color-55, #FFFFFF);
  }
</style>