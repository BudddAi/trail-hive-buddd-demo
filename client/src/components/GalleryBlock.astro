---
import 'swiper/css';
import 'swiper/css/pagination';
import 'swiper/css/navigation';
import ModuleWrapper from '../utils/ModuleWrapper.astro';
import { assetsPath } from '../utils/strapi';
import Heading from './molecules/Heading.astro';
import Image from './molecules/Image.astro';
import CarouselArrowButton from './molecules/CarouselArrowButton.astro';

interface GalleryBlockProps {
  heading: {
    text: string;
    subheading?: string;
    tag?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';
    preheading?: string;
  };
  images: Array<{
    url: string;
    alternativeText?: string;
    width?: number;
    height?: number;
  }>;
  spacing?: any;
}

export interface Props extends GalleryBlockProps {}

const { 
  heading,
  images = [],
  spacing
} = Astro.props;
---

<ModuleWrapper className="gallery-block" spacing={spacing}>
  <div class="bg-color-5 py-16 md:py-20 lg:py-24 overflow-x-clip">
    <div class="container">
      {heading && (
        <Heading
          as={heading.tag || 'h2'}
          heading={heading.text}
          subheading={heading.subheading}
          preheading={heading.preheading}
          className="items-center text-center"
          headingClassName="font-font-3 font-bold text-4xl lg:text-5xl leading-lh-1 tracking-tracking-1 text-color-37"
          subheadingClassName="font-font-3 font-normal text-lg leading-lh-16 text-color-37"
        />
      )}
    </div>

    {images && images.length > 0 && (
      <div class="relative mt-12 md:mt-16">
        <div class="swiper gallery-block-swiper !overflow-visible">
          <div class="swiper-wrapper">
            {images.map(image => (
              <div class="swiper-slide">
                <Image
                  src={assetsPath(image.url) || ''}
                  alt={image.alternativeText || 'Gallery image'}
                  className="w-full h-auto aspect-[4/3] object-cover rounded-radius-3"
                />
              </div>
            ))}
          </div>
        </div>

        <div class="gallery-prev-button absolute top-1/2 -translate-y-1/2 left-4 md:left-8 lg:left-16 z-20 cursor-pointer hidden md:block">
          <CarouselArrowButton direction="left" />
        </div>
        <div class="gallery-next-button absolute top-1/2 -translate-y-1/2 right-4 md:right-8 lg:right-16 z-20 cursor-pointer hidden md:block">
          <CarouselArrowButton direction="right" />
        </div>

        <div class="gallery-pagination flex justify-center gap-2 mt-8 relative z-10"></div>
      </div>
    )}
  </div>
</ModuleWrapper>

<script>
  import { Swiper } from 'swiper';
  import { Navigation, Pagination, Autoplay } from 'swiper/modules';

  document.addEventListener('DOMContentLoaded', () => {
    const swiperElement = document.querySelector('.gallery-block-swiper');
    if (swiperElement) {
      new Swiper('.gallery-block-swiper', {
        modules: [Navigation, Pagination, Autoplay],
        loop: true,
        centeredSlides: true,
        autoplay: {
          delay: 3500,
          disableOnInteraction: false,
        },
        spaceBetween: 24,
        slidesPerView: 1.2,
        breakpoints: {
          640: {
            slidesPerView: 2.5,
          },
          1024: {
            slidesPerView: 3.5,
          },
        },
        navigation: {
          nextEl: '.gallery-next-button',
          prevEl: '.gallery-prev-button',
        },
        pagination: {
          el: '.gallery-pagination',
          clickable: true,
        },
      });
    }
  });
</script>

<style is:global>
  .gallery-block-swiper .swiper-pagination-bullet {
    width: 8px;
    height: 8px;
    background-color: #d9efde;
    opacity: 0.5;
    transition: opacity 0.3s, background-color 0.3s;
  }
  .gallery-block-swiper .swiper-pagination-bullet-active {
    background-color: #ffffff;
    opacity: 1;
  }
</style>